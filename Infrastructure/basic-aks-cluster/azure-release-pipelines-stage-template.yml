parameters: 
- name: stageName
  default: ''
- name: environment
  default: ''
- name: azureServiceConnection
  default: ''
- name: resourceGroupName
  default: ''
- name: clusterName
  default: ''


stages:
  - stage: ${{ parameters.stageName }}
    displayName: ${{ parameters.stageName }}

    jobs:
    - deployment: Deploy
      displayName: Deploy
      environment: ${{ parameters.environment }}
      pool:
        vmImage: 'ubuntu-latest'
  
      strategy:
        runOnce:
          deploy:
  
            steps:
            - task: AzureCLI@2
              inputs:
                azureSubscription: $(azureServiceConnection)
                scriptType: bash
                scriptLocation: inlineScript
                inlineScript: |
                  ls
                  az group create --name $(resourceGroupName) --location $(location)
                  az deployment group create -g $(resourceGroupName)  --template-uri https://github.com/Azure/AKS-Construction/releases/download/0.8.8/main.json --parameters \
	                  resourceName=az-$(resourceGroupName) \
	                  agentCount=1 \
	                  agentVMSize=Standard_B2s \
	                  agentCountMax=5 \
	                  networkPlugin=kubenet